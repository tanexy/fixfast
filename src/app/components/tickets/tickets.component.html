<ActionBar title="Tickets" backgroundColor="#1E293B" color="white">
  <ActionItem text="Refresh" (tap)="loadTickets()" ios.position="right" android.position="actionBar"></ActionItem>
</ActionBar>

<GridLayout rows="auto, *" backgroundColor="#F8FAFC">
  <!-- Status Filter Header -->
  <StackLayout row="0" class="status-filter-container">
    <ScrollView orientation="horizontal" class="status-filter">
      <StackLayout orientation="horizontal" class="p-3">
        <Button *ngFor="let option of statusOptions" [text]="option.display + ' (' + option.count + ')'"
          (tap)="onStatusFilterChange(option.key)"
          [class]="selectedStatus === option.key ? 'filter-btn active' : 'filter-btn'" class="mr-3"></Button>
      </StackLayout>
    </ScrollView>
  </StackLayout>

  <!-- Tickets List -->
  <ScrollView row="1" class="tickets-container">
    <StackLayout class="p-4">

      <StackLayout *ngIf="filteredTickets.length === 0" class="empty-state">
        <Label text="ðŸŽ«" class="empty-icon"></Label>
        <Label text="No tickets found" class="empty-title"></Label>
        <Label text="All issues have been resolved or check your filters" class="empty-subtitle"></Label>
      </StackLayout>

      <StackLayout *ngFor="let ticket of filteredTickets" class="ticket-card">

        <!-- Ticket Header -->
        <GridLayout columns="*, auto" class="ticket-header">
          <StackLayout col="0" class="ticket-title-section">
            <Label [text]="ticket.title" class="ticket-title" textWrap="true"></Label>
            <Label [text]="'#' + ticket.id" class="ticket-id"></Label>
          </StackLayout>
          <StackLayout col="1" class="badges-container" orientation="horizontal">
            <Label [text]="ticket.priority.toUpperCase()" [backgroundColor]="getPriorityColor(ticket.priority)"
              class="priority-badge"></Label>
          </StackLayout>
        </GridLayout>

        <!-- Status Badge (Full Width) -->
        <Label [text]="ticket.status.replace('-', ' ').toUpperCase()" [backgroundColor]="getStatusColor(ticket.status)"
          class="status-badge-full"></Label>

        <!-- Ticket Description -->
        <Label [text]="ticket.description" class="ticket-description" textWrap="true"></Label>

        <!-- Ticket Meta Information -->
        <GridLayout columns="*, *" class="ticket-meta">
          <StackLayout col="0" class="meta-left">
            <StackLayout orientation="horizontal" class="meta-item">
              <Label text="ðŸ“" class="meta-icon"></Label>
              <Label [text]="ticket.location" class="meta-text"></Label>
            </StackLayout>
            <StackLayout orientation="horizontal" class="meta-item">
              <Label text="ðŸ‘¤" class="meta-icon"></Label>
              <Label [text]="ticket.reportedBy" class="meta-text"></Label>
            </StackLayout>
          </StackLayout>

          <StackLayout col="1" class="meta-right">
            <Label [text]="ticket.createdAt | date:'MMM d, y'" class="meta-date"></Label>
            <StackLayout orientation="horizontal" class="meta-item assignee">
              <Label text="ðŸ”§" class="meta-icon"></Label>
              <Label [text]="ticket.assignedTo || 'Unassigned'"
                [class]="ticket.assignedTo ? 'meta-text assigned' : 'meta-text unassigned'"></Label>
            </StackLayout>
          </StackLayout>
        </GridLayout>

      </StackLayout>

    </StackLayout>
  </ScrollView>
</GridLayout>